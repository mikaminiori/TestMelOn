machine:
  timezone:
    Asia/Tokyo
  post:
    - npm install g npm@3.3.12

dependencies:
    override:
        - sudo pip install awscli
    post:
        - aws configure set region ap-northeast-1
        - npm run build
test:
 override:
  - echo Hello MelOn
  
deployment:
  production:
    branch: master
    codedeploy:
      testMelOndeploy:
        application_root: ~/var/www/http
        region: ap-northeast-1
        revision_location:
         revison_type: S3
        s3_location:
          bucket: stg.circlecitest
          key_pattern: '{BUILD_NUM}_{COMMIT}.zip'
        deployment_group: testdeploy
#    commands:
#      - aws s3 sync ./ s3://prod.circlecitest/ --delete

  staging:
    branch: staging
    commands:
      - aws s3 sync ./ s3://stg.circlecitest/ --delete  
    codedeploy:
      testMelOndeploy:
        application_root: ~/var/www/http
        region: ap-northeast-1
        revision_location:
         revison_type: S3
         s3_location:
          bucket: stg.circlecitest
          key_pattern: '{BUILD_NUM}_{COMMIT}.zip'
        deployment_group: testdeploy
        deployment_config: CodeDeployDefault.AllAtOnce

  
